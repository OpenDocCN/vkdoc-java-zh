# 二十八、反模式：避免常见错误

没有反模式，设计模式的讨论就不完整。本章简要概述了反模式。我们开始吧。

## 什么是反模式？

在现实世界的应用程序开发中，您可能会遵循最初非常吸引人的方法，但是从长远来看，它们会带来问题。例如，你试图快速解决问题，以满足交货期限，但如果你没有意识到潜在的陷阱，你可能会付出很大的代价。

反模式提醒您会导致糟糕解决方案的常见错误。了解它们有助于你采取预防措施。“预防胜于治疗”这句谚语非常适合这种情况。

### 注意

反模式通过描述有吸引力的方法如何使您未来的生活变得困难，提醒您常见的错误。与此同时，他们提出了一些替代解决方案，这些方案在开始时可能看起来很难，但最终会帮助你建立一个更好的解决方案。简而言之，反模式识别既定实践中的问题，它们可以将一般情况映射到特定类别的高效解决方案。他们还可以提供更好的计划来扭转一些不良做法，并制定健康的解决方案。

## 反模式简史

设计模式的最初想法来自建筑建筑师 Christopher Alexander。他分享了他在规划良好的城镇中建造建筑物的想法。渐渐地，这些概念进入了软件开发，并通过像沃德·坎宁安和肯特·贝克这样的前沿软件开发人员而流行起来。1994 年，通过一个关于设计模式的行业会议，设计模式的思想进入了主流的面向对象软件开发，被称为程序设计的模式语言(PLoP)。它是由希尔赛德集团主办的。吉姆·科普林的论文《生成模式语言的发展过程》就是在这种背景下发表的著名论文。随着四人帮推出经典文本*设计模式:可重用面向对象软件的元素*，设计模式变得非常流行。

毫无疑问，这些伟大的设计模式帮助了(并且仍然在帮助)程序员开发高质量的软件。但是人们也开始注意到负面影响。一个常见的例子是，许多开发人员想要展示他们的专业知识，而没有对这些模式在其特定领域中的结果进行真正的评估。作为一个明显的副作用，模式被植入了错误的上下文中，这产生了低质量的软件，并最终对开发者和他们的公司造成了巨大的损失。

因此，软件行业需要关注这些错误的负面后果，最终，反模式的思想得到了发展。许多专家开始在这一领域做出贡献，但是第一个结构良好的模型来自 Michael Akroyd 的演讲“反模式:针对对象误用的疫苗”这是 GoF 设计模式的对外观。

术语*反模式*在他们的书*反模式:重构软件、架构和危机中的项目* (Wiley，1998)中变得流行起来。后来，斯科特·托马斯加入了他们的小组。他们说，

> 由于反模式有如此多的贡献者，将反模式的最初想法分配给单一来源是不公平的。相反，反模式是补充设计模式运动和扩展设计模式模型的自然步骤。

## 反模式的例子

下面是一些反模式及其背后的概念/思维模式的例子。

*   *过度使用模式*:开发人员可能会不惜任何代价尝试使用模式，不管它是否合适。

*   *神类*:试图用许多不相关的方法控制几乎一切的大物体。不恰当地使用中介模式可能会导致这种反模式。

*   *不是在这里发明的*:我是一家大公司，我希望一切从零开始。虽然已经有一个由小公司开发的库，但我不会使用它。我会自己做所有的东西，一旦开发出来，我会用我的品牌价值宣布，“嘿，伙计们。终极图书馆为你而生。

**   *零表示空*:一个常见的例子包括开发者认为没有人想在纬度零，经度零。另一种常见的变化是程序员使用:1，999 或类似的数字来表示不合适的整数值。当用户在应用程序中将“09/09/9999”视为空日期时，会观察到另一个错误的用例。因此，在这些情况下，如果用户需要数字:1，999 或日期“09/09/9999”，他将无法获得这些数字。

    *   *金锤*:X 先生相信技术 T 永远是最好的。所以，如果他需要开发一个新系统(这需要新的学习)，他仍然更喜欢 T，即使它不合适。他认为，“如果我能用 t 来管理它，我就不需要学习更多的技术了。”

    *   *数字管理*:提交次数越多，代码行数越多，或者修复的缺陷越多，都是伟大开发者的标志。比尔·盖茨说过，“用代码行数来衡量编程进度，就像用重量来衡量飞机制造进度一样。”

    *   *拍信使*:你已经有压力了，节目截止日期快到了。有一个聪明的测试人员，他总能找到难以修复的典型缺陷。所以，在这个阶段，你不想让他参与进来，因为他会发现更多的缺陷，可能会错过最后期限。

    *   *瑞士军刀*:要求产品能够满足顾客的各种需求。或者制造一种可以治愈所有疾病的药物。或者设计服务于各种不同需求的客户的软件。界面有多复杂并不重要。

    *   *复制粘贴编程*:我需要解决一个问题，但是我已经有了一段代码来处理类似的情况。因此，我可以复制当前正在运行的旧代码，并在必要时开始修改它。但是当你从一个现有的拷贝开始时，你基本上继承了所有与之相关的潜在缺陷。此外，如果将来需要修改原始代码，您需要在多个地方实现修改。这种做法也违反了*不重复自己*的原则。

    *   *架构师不编码*:我是一个架构师。我的时间很宝贵。我将只展示路径或给出一个关于编码的伟大演讲。有足够多的实施者应该实施我的想法。*架构师打高尔夫*是这个反模式的姐妹。

    *   *隐藏并悬停*:不要暴露所有编辑或删除链接，直到他/她悬停在元素上。

    *   *伪装链接和广告*:当用户点击一个链接或一个广告时获得收入，但他们不能得到他们想要的。* 

 *### 注意

现在，您可以从不同的网站/来源了解各种反模式。例如，一个维基百科页面谈到了各种反模式(参见 [`https://en.wikipedia.org/wiki/Antipattern`](https://en.wikipedia.org/wiki/Antipattern) ) *。*您还可以在 [`http://wiki.c2.com/?AntiPatternsCatalog`](http://wiki.c2.com/%253FAntiPatternsCatalog) 获得反模式目录的详细列表，以了解更多信息。您可能还会注意到，反模式的概念并不局限于面向对象的编程。

## 反模式的类型

反模式可以属于多个类别。甚至一个典型的反模式也可以属于多个类别。

以下是一些常见的分类。

*   *架构反模式*:瑞士军刀反模式就是这一类的例子。

*   *开发反模式*:God 类和过度使用模式就是这一类的例子。

*   *管理反模式*:拍摄信使反模式就属于这一类。

*   *组织反模式*:架构师不编码，架构师打高尔夫就是这一类的例子。

*   用户界面反模式:例子包括伪装的链接和广告。

### 注意

伪装链接和广告也被称为*黑暗模式*。

## 问答环节

1.  反模式和设计模式有什么关系？

    使用设计模式，您可以重用前人的经验。当你开始仅仅为了使用而盲目地使用这些概念时，你就陷入了*重复使用循环解决方案*的陷阱。这会让你陷入糟糕的境地。然后你会发现你的投资回报在不断减少，但维护成本却在不断增加。表面上简单和标准的解决方案(或模式)可能会在将来给你带来更多的问题。

2.  设计模式可能会变成反模式。这是正确的吗？

    是的。如果你在错误的环境中应用了一个设计模式，那会带来比它所解决的问题更多的麻烦。最终它会变成一个反模式。所以，理解问题的本质和背景是非常重要的。

3.  反模式只与软件开发人员相关。这是正确的吗？

    不。反模式的用处不仅限于开发人员；它可能也适用于其他人；例如，反模式对经理和技术架构师也很有用。

4.  即使您现在没有从反模式中获得太多好处，它们也可以帮助您在将来以更少的维护成本轻松适应新的特性。这是正确的吗？

    是的。

5.  **反模式的** **原因** **可能有哪些？**

    It can come from various sources/mindsets. The following are a few common examples.
    *   “我们需要尽快交付产品。”

    *   “我们现在不需要分析影响。”

    *   “我是重用专家。我非常了解设计模式。”

    *   “我们将使用最新的技术和功能来打动我们的客户。我们不需要关心传统系统。”

    *   "更复杂的代码将反映我在这方面的专业知识."

6.  **讨论一些** **症状** **的反模式。**

    在面向对象编程中，最常见的症状是您的系统不能轻易地适应新的特性。此外，维护成本也在不断增加。您可能还会注意到，您已经失去了关键的面向对象特性的能力，比如继承、多态等等。

    Apart from these, you may notice some/all of the following symptoms.
    *   全局变量的使用

    *   代码复制

    *   有限/没有代码重用

    *   一大类(神类)

    *   大量的无参数方法等。

7.  **如果检测到反模式，有什么** **补救措施** **？**

    您可能需要遵循重构的更好的解决方案。例如，下面是一些避免反模式的解决方案。

    *金锤*:你可以尝试通过适当的训练来教育 X 先生。

    *零表示空值*:你可以使用一个额外的布尔变量来恰当地表示空值。

    *数字管理*:如果你明智地使用数字，数字就是好的。你不能通过一个程序员每周修复的缺陷数量来判断他/她的能力。质量也很重要。一个典型的例子包括修复一个简单的 UI 布局比修复系统中的一个严重的内存泄漏要容易得多。考虑另一个例子。“更多数量的测试通过”并不意味着您的系统更加稳定，除非测试使用不同的代码路径/分支。

    *拍摄信使*:欢迎测试人员并立即让他参与进来。他可以在早期发现典型的缺陷，你可以避免最后一刻的意外。

    *复制粘贴编程*:你可以重构你的代码，而不是寻找一个快速的解决方案。您还可以创建一个公共场所来维护经常使用的方法，以避免重复并提供更容易的维护。

    架构师不编码:让架构师参与部分实现阶段。这对组织和架构师都有帮助。这项活动可以让他们更清楚地了解产品的真正功能。

8.  你说的重构是什么意思？

    在编码领域，术语*重构*意味着改进现有代码的设计，而不改变系统/应用程序的外部行为。这个过程有助于您获得更具可读性的代码。同时，代码应该更能适应新的需求(或者变更请求),并且更易于维护。*